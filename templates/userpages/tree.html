{% extends 'userpages/sidebar.html' %}
{% block content %}
{% load static %}
<div class="main-content">
  <div class="page-content">
    <div class="container-fluid">
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Poppins&display=swap");

      body {
        font-family: "Outfit", sans-serif;
        background: linear-gradient(
          83deg,
          rgb(24, 45, 56) 0%,
          rgb(28, 37, 39) 36%,
          rgb(0, 0, 0) 100%
        ) !important;
      }

      /* Chrome, Safari, Edge, Opera */
      input::-webkit-outer-spin-button,
      input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }

      .button {
        display: inline-block;
        position: relative;
        overflow: hidden;
        transition: all 0.5s ease-in;
        z-index: 1;
        box-shadow: 0px 0px 10px #2a7a8a;
      }

      .button::before,
      .button::after {
        content: "";
        position: absolute;
        top: 0;
        width: 0;
        height: 100%;
        transform: skew(15deg);
        transition: all 0.5s;
        overflow: hidden;
        z-index: -1;
      }

      .button::before {
        left: -10px;
        background: #469cad;
      }

      .button::after {
        right: -10px;
        background: #2a7a8a;
      }

      .button:hover::before,
      .button:hover::after {
        width: 58%;
      }
    </style>
    <style>
      /*----------------genealogy-scroll----------*/

      .genealogy-scroll::-webkit-scrollbar {
        width: 5px;
        height: 8px;
      }
      .genealogy-scroll::-webkit-scrollbar-track {
        border-radius: 10px;
        background-color: #e4e4e4;
      }
      .genealogy-scroll::-webkit-scrollbar-thumb {
        background: #1b525e;
        border-radius: 10px;
        transition: 0.5s;
      }
      .genealogy-scroll::-webkit-scrollbar-thumb:hover {
        background: #469cad;
        transition: 0.5s;
      }

      /*----------------genealogy-tree----------*/
      .genealogy-body {
        white-space: nowrap;
        overflow-y: scroll;
        padding: 50px;
        padding-top: 10px;
        text-align: center;
      }
      .genealogy-tree {
        display: inline-block;
      }
      .genealogy-tree ul {
        padding-top: 20px;
        position: relative;
        padding-left: 0px;
        display: flex;
        justify-content: center;
      }
      .genealogy-tree li {
        text-align: center;
        list-style-type: none;
        position: relative;
        padding: 20px 5px 0 5px;
      }
      .genealogy-tree li::before,
      .genealogy-tree li::after {
        content: "";
        position: absolute;
        top: 0;
        right: 50%;
        border-top: 2px solid #ccc;
        width: 50%;
        height: 18px;
      }
      .genealogy-tree li::after {
        right: auto;
        left: 50%;
        border-left: 2px solid #ccc;
      }
      .genealogy-tree li:only-child::after,
      .genealogy-tree li:only-child::before {
        display: none;
      }
      .genealogy-tree li:only-child {
        padding-top: 0;
      }
      .genealogy-tree li:first-child::before,
      .genealogy-tree li:last-child::after {
        border: 0 none;
      }
      .genealogy-tree li:last-child::before {
        border-right: 2px solid #ccc;
        border-radius: 0 5px 0 0;
        -webkit-border-radius: 0 5px 0 0;
        -moz-border-radius: 0 5px 0 0;
      }
      .genealogy-tree li:first-child::after {
        border-radius: 5px 0 0 0;
        -webkit-border-radius: 5px 0 0 0;
        -moz-border-radius: 5px 0 0 0;
      }
      .genealogy-tree ul ul::before {
        content: "";
        position: absolute;
        top: 0;
        left: 50%;
        border-left: 2px solid #ccc;
        width: 0;
        height: 20px;
      }

      /*--------------memeber-card-design----------*/
      .member-view-box {
        width: 150px;
        margin: auto;
        text-align: center;
        position: relative;
      }
      .member-view-box img {
        width: 60px;
      }
      .member-view-box .info {
        display: none;
      }
      .member-details .info {
        display: none;
      }
      .member-view-box:hover .info {
        display: block;
        position: absolute;
        background-color: #166575;
        left: 0;
        top: 65px;
        z-index: 10;
        border-radius: 15px;
      }
      .member-details:hover .info {
        display: block;
        position: absolute;
        background-color: #166575;
        left: 0;
        top: 65px;
        z-index: 10;
        border-radius: 15px;
      }
    </style>
  


    <div class="container-fluid p-0">
      <div class="container-xxl px-0">

        <div class="container-fluid">
          <div class="container-xxl">
            <div class="row mx-0 px-lg-2 py-lg-5 p-md-4 px-0 py-5">
              <div class="col-12 mx-auto p-0">
                <div class="body genealogy-body genealogy-scroll">
                  <div class="genealogy-tree">
                    <ul>
                      <li>
                        <div
                          class="member-view-box d-flex flex-column align-items-center gap-2"
                        >
                          <img
                            src="{% static 'assets/images/users/user.png' %}"
                            class="img-fluid rounded-circle image"
                            alt=""
                          />
                          <p class="text-white mb-0">{{user.username}}</p>
                          <div class="py-3 px-4 info">
                            <div class="d-flex gap-2">
                              <p class="text-white mb-0 fw-semibold">Name:</p>
                              <p class="text-white mb-0 text-opacity-75">{{user.first_name}} {{user.last_name}}</p>
                            </div>
                            <div class="d-flex gap-2 my-2">
                              <p class="text-white mb-0 fw-semibold">Total Business:</p>
                              <p class="text-white mb-0 text-opacity-75">$ {{user.business}}</p>
                            </div>
                            <div class="d-flex gap-2 my-2">
                              <p class="text-white mb-0 fw-semibold">Membership Status</p>
                              <p class="text-white mb-0 text-opacity-75">
                                {% if user.user.paid_members == 'True' %}
                    <span class='badge text-white text-bg-success p-2 rounded-pill'>Active</span>
                   {% else %}
                   <span class='badge text-white text-bg-warning p-2 rounded-pill'>Inactive</span>
                   {% endif %}
                              </p>
                            </div>
                            <div class="d-flex gap-2 my-2">
                              <p class="text-white mb-0 fw-semibold">Referral Code</p>
                              <p class="text-white mb-0 text-opacity-75">{{user.referal_code}}</p>
                            </div>
                            <div class="d-flex gap-2">
                              <p class="text-white mb-0 fw-semibold">Referral Income</p>
                              <p class="text-white mb-0 text-opacity-75">$ {{usr_ref_income}}</p>
                            </div>
                          </div>
                        </div>
                        <ul class="active">
                        {% for i in data %}
                        
                          <li id='demo{{i.data.id}}' data-pid="{{ i.data.id }}"
                          class='childItem'>
                            <div
                          class="member-view-box d-flex flex-column align-items-center gap-2"
                        >
                          <img
                            src="{% static 'assets/images/users/user.png' %}"
                            class="img-fluid rounded-circle image"
                            alt=""
                          />
                          <p class="text-white mb-0">{{i.data.username}}</p>
                          <div class="py-3 px-4 info">
                            <div class="d-flex gap-2">
                              <p class="text-white mb-0 fw-semibold">Name:</p>
                              <p class="text-white mb-0 text-opacity-75">{{i.data.first_name}} {{i.last_name}}</p>
                            </div>
                            <div class="d-flex gap-2 my-2">
                              <p class="text-white mb-0 fw-semibold">Total Business:</p>
                              <p class="text-white mb-0 text-opacity-75">$ {{i.data.business}}</p>
                            </div>
                            <div class="d-flex gap-2 my-2">
                              <p class="text-white mb-0 fw-semibold">Membership Status</p>
                              <p class="text-white mb-0 text-opacity-75">
                                {% if i.data.paid_members == 'True' %}
                    <span class='badge text-white text-bg-success p-2 rounded-pill'>Active</span>
                   {% else %}
                   <span class='badge text-white text-bg-warning p-2 rounded-pill'>Inactive</span>
                   {% endif %}
                              </p>
                            </div>
                            <div class="d-flex gap-2 my-2">
                              <p class="text-white mb-0 fw-semibold">Referral Code</p>
                              <p class="text-white mb-0 text-opacity-75">{{i.data.referal_code}}</p>
                            </div>
                            <div class="d-flex gap-2">
                              <p class="text-white mb-0 fw-semibold">Referral Income</p>
                              <p class="text-white mb-0 text-opacity-75">$ {{i.direct_income}}</p>
                            </div>
                          </div>
                        
                      </div>
                      <ul id="child{{i.data.id}}"></ul>
                      
                    </li>
                        {% endfor %} 
                  </ul>
                  </li>
                    </ul>   
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div></div></div>

    {% comment %} <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
      crossorigin="anonymous"
    ></script> {% endcomment %}
    {% comment %} <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
      integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script> {% endcomment %}
    <script>
      $(function () {
        $(document.body).find(".genealogy-tree ul").hide();
        $(document.body).find(".genealogy-tree>ul").show();
        $(document.body).find(".genealogy-tree ul.active").show();
        $(document.body).on("click",".genealogy-tree li", function (e) {
          var children = $(this).find("> ul");
          if (children.is(":visible"))
            
            children.hide("fast").removeClass("active");
          else children.show("fast").addClass("active");
          e.stopPropagation();

          var pid = $(this).attr("data-pid");
          var id =$(this).attr("id")
          var ref = $(this);
          console.log(pid);
          console.log(id);

          $.ajax({
            type: "GET",
            url: "../../../get_refferal/" + `${pid}`,
            success: function (data) {
              var ar = [];
              var ar1 = [];
              console.log(data);
              if (data.status == 1) {
              
                $.each(data.data, function (key, data) {
                  console.log(data.id)
                  let v = `<li id='demo${data.data.id}' data-pid="${data.data.id}"
                  class='childItem'>
                    <div
                  class="member-view-box d-flex flex-column align-items-center gap-2"
                >
                  <img
                    src="{% static 'assets/images/users/user.png' %}"
                    class="img-fluid rounded-circle image"
                    alt=""
                  />
                  <p class="text-white mb-0">${data.data.username}</p>
                  <div class="py-3 px-4 info">
                    <div class="d-flex gap-2">
                      <p class="text-white mb-0 fw-semibold">Name:</p>
                      <p class="text-white mb-0 text-opacity-75">${data.data.first_name} ${data.data.last_name}</p>
                    </div>
                    <div class="d-flex gap-2 my-2">
                      <p class="text-white mb-0 fw-semibold">Total Business:</p>
                      <p class="text-white mb-0 text-opacity-75">$ ${data.data.business}</p>
                    </div>
                    <div class="d-flex gap-2 my-2">
                      <p class="text-white mb-0 fw-semibold">Membership Status</p>
                      <p class="text-white mb-0 text-opacity-75">`
                        
                            if (data.data.paid_members=='True'){
                              v +=`<span class='badge text-white text-bg-success p-2 rounded-pill'>Active</span>`
                            }else{
                              v+= `<span class='badge text-white text-bg-warning p-2 rounded-pill'>Inactive</span>`
                            }
           
                      v+=      `
                      </p>
                    </div>
                    <div class="d-flex gap-2 my-2">
                      <p class="text-white mb-0 fw-semibold">Referral Code</p>
                      <p class="text-white mb-0 text-opacity-75">${data.data.referal_code}</p>
                    </div>
                    <div class="d-flex gap-2">
                      <p class="text-white mb-0 fw-semibold">Referral Income</p>
                      <p class="text-white mb-0 text-opacity-75">$ ${data.direct_income}</p>
                    </div>
                  </div>
                
              </div>
              <ul id="child${data.data.id}"></ul>
              
            </li>`;
                  ar.push(v);
                });
              
                  

                 
                 
                  let collapse = `
                                        ${ar.join("")}
                                       `;
                      
                              
                                       let g=$(document.body).find(`#child${pid}`);
                                       g.html(
                                         collapse
                                       );
                  
              } 
              
            },
            error: function () {},
          });


        });
      });

    </script>

    {% endblock %}
